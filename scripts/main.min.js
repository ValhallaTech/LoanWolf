function calculate(){var i=document.getElementById("amount"),r=document.getElementById("apr"),u=document.getElementById("years"),o=document.getElementById("zipcode"),s=document.getElementById("payment"),h=document.getElementById("total"),c=document.getElementById("totalinterest"),f=parseFloat(i.value),e=parseFloat(r.value)/1200,t=parseFloat(u.value)*12,l=Math.pow(1+e,t),n=f*l*e/(l-1);if(isFinite(n)){s.innerHTML=n.toFixed(2);h.innerHTML=(n*t).toFixed(2);c.innerHTML=(n*t-f).toFixed(2);save(i.value,r.value,u.value,o.value);try{getLenders(i.value,r.value,u.value,o.value)}catch(a){}chart(f,e,n,t)}else s.innerHTML="",h.innerHTML="",c.innerHTML="",chart()}function save(n,t,i,r){window.localStorage&&(localStorage.loan_amount=n,localStorage.loan_apr=t,localStorage.loan_years=i,localStorage.loan_zipcode=r)}function getLenders(n,t,i,r){var f,e,u;window.XMLHttpRequest&&(f=document.getElementById("lenders"),f)&&(e="getLenders.php?amt="+encodeURIComponent(n)+"&apr="+encodeURIComponent(t)+"&yrs="+encodeURIComponent(i)+"&zip="+encodeURIComponent(r),u=new XMLHttpRequest,u.open("GET",e),u.send(null),u.onreadystatechange=function(){var n;if(u.readyState==4&&u.status==200){var r=u.responseText,t=JSON.parse(r),i="";for(n=0;n<t.length;n++)i+="<li><a href='"+t[n].url+"'>"+t[n].name+"<\/a>";f.innerHTML="<ul>"+i+"<\/ul>"}})}function chart(n,t,i,r){function f(n){return n*d/r}function e(n){return k-n*k/(i*r*1.05)}var c=document.getElementById("graph"),v,l,o,y,s,p,w,b,a,h;if(c.width=c.width,arguments.length!=0&&c.getContext){var u=c.getContext("2d"),d=c.width,k=c.height;for(u.moveTo(f(0),e(0)),u.lineTo(f(r),e(i*r)),u.lineTo(f(r),e(0)),u.closePath(),u.fillStyle="#f88",u.fill(),u.font="bold 12px sans-serif",u.fillText("Total Interest Payments",20,20),v=0,u.beginPath(),u.moveTo(f(0),e(0)),o=1;o<=r;o++)y=(n-v)*t,v+=i-y,u.lineTo(f(o),e(v));for(u.lineTo(f(r),e(0)),u.closePath(),u.fillStyle="green",u.fill(),u.fillText("Total Equity",20,35),l=n,u.beginPath(),u.moveTo(f(0),e(l)),o=1;o<=r;o++)y=l*t,l-=i-y,u.lineTo(f(o),e(l));for(u.lineWidth=3,u.stroke(),u.fillStyle="black",u.fillText("Loan Balance",20,50),u.textAlign="center",h=e(0),s=1;s*12<=r;s++)p=f(s*12),u.fillRect(p-.5,h-3,1,3),s==1&&u.fillText("Year",p,h-5),s%5==0&&s*12!==r&&u.fillText(String(s),p,h-5);for(u.textAlign="right",u.textBaseline="middle",w=[i*r,n],b=f(r),a=0;a<w.length;a++)h=e(w[a]),u.fillRect(b-3,h-.5,3,1),u.fillText(String(w[a].toFixed(0)),b-5,h)}}document.getElementById("calculate").addEventListener("click",()=>{calculate()});document.querySelectorAll(".numbersOnly").forEach(n=>{n.addEventListener("keydown",n=>{let t=n.which?n.which:n.keyCode;return t>=48&&t<=57||t>=96&&t<=105||t==8||t==37||t==39?!0:(n.preventDefault(),!1)})});window.onload=function(){window.localStorage&&localStorage.loan_amount&&(document.getElementById("amount").value=localStorage.loan_amount,document.getElementById("apr").value=localStorage.loan_apr,document.getElementById("years").value=localStorage.loan_years,document.getElementById("zipcode").value=localStorage.loan_zipcode)};$(function(){$('[data-toggle="tooltip"]').tooltip()});